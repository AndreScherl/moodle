YUI.add("moodle-atto_clozeeditor-button",function(a,b){var c="atto_clozeeditor",d={WIDTH:"800px"},e='<form class="{{CSS.FORM}}"><fieldset><div class="{{CSS.FORMSETTINGS}}"><label for="{{elementid}}_atto_clozeeditor_type">{{get_string "type" component}}</label><select class="{{CSS.TYPE}}" id="atto_clozeeditor_type" /><option value="1" selected="selected">{{get_string "shortanswer" component}}</option><option value="2">{{get_string "shortanswer_c" component}}</option><option value="3">{{get_string "multichoice" component}}</option><option value="4">{{get_string "multichoice_v" component}}</option><option value="5">{{get_string "multichoice_h" component}}</option><option value="6">{{get_string "numerical" component}}</option></select></div><div class="{{CSS.FORMSETTINGS}}"><label for="{{elementid}}_atto_clozeeditor_points">{{get_string "points" component}}</label><select class="{{CSS.POINTS}}" id="atto_clozeeditor_points" /><option value="1" selected="selected">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div></fieldset><br/><div><div class="{{CSS.ANSWER}}"><label for="answer_0">{{get_string "answer" component}}</label></div><div class="{{CSS.PERCENTAGE}}"><label for="{{elementid}}_atto_clozeeditor_percentage">{{get_string "percentage" component}}</label></div><div class="{{CSS.FEEDBACK}}"><label for="{{elementid}}_atto_clozeeditor_feedback">{{get_string "feedback" component}}</label></div></div><div class="{{CSS.OBJANSWER}}" id="atto_clozeeditor_answers" ><fieldset id="atto_clozeeditor_fieldset_answer"><div class="{{CSS.ANSWER}}"><input class="{{CSS.ANSWER}}" id="answer_0" /></div><div class="{{CSS.PERCENTAGE}}"><select class="{{CSS.PERCENTAGE}}" id="{{elementid}}_atto_clozeeditor_percentage" /><option value="100" selected="selected">100%</option><option value="75">75%</option><option value="67">66,6%</option><option value="50">50%</option><option value="34">33,3%</option><option value="25">25%</option><option value="0">0%</option></select></div><div class="{{CSS.FEEDBACK}}"><input class="{{CSS.FEEDBACK}}" id="{{elementid}}_atto_clozeeditor_feedback" /></div></fieldset></div><br/><div id="addanswers"> </div><div class="mdl-align"><br/><button class="submit" type="submit">{{get_string "createcloze" component}}</button></div></form>',f={TYPE:"type",POINTS:"points",OBJANSWER:"objanswer",ANSWER:"answer",PERCENTAGE:"percentage",FEEDBACK:"feedback",ADD:"add",SUBMIT:"submit",FORM:"atto_form",WIDTH:"customwidth",WIDTHUNIT:"%",FORMSETTINGS:"formsettings"},g={TYPE:"."+f.TYPE,POINTS:"."+f.POINTS,OBJANSWER:"."+f.OBJANSWER,ANSWER:"."+f.ANSWER,PERCENTAGE:"."+f.PERCENTAGE,FEEDBACK:"."+f.FEEDBACK,ADD:".add",SUBMIT:".submit",FORM:"."+f.FORM,WIDTH:"."+f.WIDTH};a.namespace("M.atto_clozeeditor").Button=a.Base.create("button",a.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_contextMenu:null,_lastTarget:null,_menuOptions:null,initializer:function(){this.addButton({icon:"e/question",callback:this._displayDialogue}),this.get("host").on("atto:selectionchanged",function(){this._existingCloze()?this.highlightButtons():this.unHighlightButtons()},this)},_storeCloze:function(b){var e,f,g=new Array(3),h=new Array(3);if(this._getClozeSpan()){b.clozeSpan=this.get("host").getSelectionParentNode().parentNode;var i=b.clozeSpan.innerHTML,j=i.indexOf("{"),l=i.indexOf("}");i=i.slice(j+1,l)}else if(this._getTinyCloze()){var i=this.get("host").getSelection().toString();i=i.slice(1,i.length-1)}h=i.split(":"),"SHORTANSWER"===h[1]?h[1]=1:"SHORTANSWER_C"===h[1]?h[1]=2:"MULTICHOICE"===h[1]?h[1]=3:"MULTICHOICE_V"===h[1]?h[1]=4:"MULTICHOICE_H"===h[1]?h[1]=5:"NUMERICAL"===h[1]?h[1]=6:h[1]=1,a.one("#atto_clozeeditor_type").set("value",h[1]),a.one("#atto_clozeeditor_points").set("value",h[0]),h[2]=h[2].split("~");for(var n=0;n<h[2].length;n++)for(h[2][n]=h[2][n].slice(1,h[2][n].length),e=h[2][n].indexOf("%"),f=h[2][n].indexOf("#"),g[0]=h[2][n].substring(e+1,f),g[1]=h[2][n].substring(0,e),g[2]=h[2][n].substring(f+1,h[2][n].length),h[2][n]=[],k=0;k<g.length;k++)h[2][n][k]=g[k];for(m=0;m<h[2].length;m++){for(var o=0;o<3;o++)a.one("#atto_clozeeditor_answers").get("children").item(m).get("children").item(o).get("children").item(0).set("value",h[2][m][o]);this._addAnswer()}return h},_getClozeSpan:function(a){return tmpNode=this.get("host").getSelectionParentNode().parentNode,"span"===tmpNode.nodeName.toLowerCase()&&"cloze"===tmpNode.getAttribute("name")},_getTinyCloze:function(a){var b=this.get("host").getSelection().toString();return b.length>1&&"{"===b[0]&&"}"===b[b.length-1]},_existingCloze:function(a){var b=this.get("host").getSelectionParentNode(),c=this.get("host").getSelection();return!!this.get("host").isActive()&&(!!b&&(!(!c||0===c.length)&&!(!this._getClozeSpan()&&!this._getTinyCloze())))},_displayDialogue:function(a){if(this._currentSelection=this.get("host").getSelection(),this._currentSelection!==!1){var b=this.getDialogue({headerContent:M.util.get_string("createcloze",c),focusAfterHide:!0,width:d.WIDTH},!0);if(b.set("bodyContent",this._getDialogueContent(a)).show(),this._getClozeSpan()||this._getTinyCloze()){this._storeCloze(a)}}},_getDialogueContent:function(b){var d=a.Handlebars.compile(e);return this._content=a.Node.create(d({CSS:f,elementid:this.get("host").get("elementid"),component:c})),this._content.one("#answer_0").on("valuechange",this._addAnswer,this),this._content.one(".submit").on("click",this._submitCloze,this),this._content},_submitCloze:function(b){var d,e,f,c=!1;b.preventDefault(),this.getDialogue({focusAfterHide:null}).hide();a.guid();switch(this.get("host").setSelection(this._currentSelection),d=b.currentTarget.ancestor(g.FORM).one(g.TYPE),e=b.currentTarget.ancestor(g.FORM).one(g.POINTS),f="{"+e.get("value"),parseInt(d.get("value"))){case 1:f+=":SHORTANSWER:";break;case 2:f+=":SHORTANSWER_C:";break;case 3:f+=":MULTICHOICE:";break;case 4:f+=":MULTICHOICE_V:";break;case 5:f+=":MULTICHOICE_H:";break;case 6:f+=":NUMERICAL:";break;default:f+=":SHORTANSWER:"}for(var i=0;i<this._content.one("#atto_clozeeditor_answers").get("children").size();i++)tmpNode=this._content.one("#atto_clozeeditor_answers").get("children").item(i),tmpNode.get("children").item(0).get("children").item(0).get("value")&&(c&&(f+="~",c=!1),f+="%"+tmpNode.get("children").item(1).get("children").item(0).get("value")+"%"+tmpNode.get("children").item(0).get("children").item(0).get("value")+"#"+tmpNode.get("children").item(2).get("children").item(0).get("value"),c=!0);f+="}",this._getClozeSpan()?this.get("host").getSelectionParentNode().parentNode.innerHTML=f:(f='<span name="cloze">'+f+"</span>",this.get("host").insertContentAtFocusPoint(f)),this.markUpdated()},_addAnswer:function(){this._content.one("#atto_clozeeditor_answers").purge(!0,"valuechange"),tmpNode=a.one("#atto_clozeeditor_fieldset_answer").cloneNode(!0),tmpNode.get("children").item(0).get("children").item(0).set("value",""),tmpNode.get("children").item(2).get("children").item(0).set("value",""),tmpNode.get("children").item(0).get("children").item(0).on("valuechange",this._addAnswer,this),a.one("#atto_clozeeditor_answers").appendChild(tmpNode)}},{})},"@VERSION@",{requires:["moodle-editor_atto-plugin","moodle-editor_atto-menu","event","event-valuechange"]});