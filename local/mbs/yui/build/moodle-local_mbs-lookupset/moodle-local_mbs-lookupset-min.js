YUI.add("moodle-local_mbs-lookupset",function(e,t){M.local_mbs=M.local_mbs||{},M.local_mbs.lookupset={init:function(t){var n,r,i,s,o=e.one("#id_"+t.name),u=e.one("#id_"+t.name+"_search"),a=e.one("#id_"+t.name+"_list");if(!u)return;u.plug(e.Plugin.AutoComplete,{resultFilters:null,resultHighligher:"phraseMatch",maxResults:t.lookupcount,source:function(n,o){var u=n.lastIndexOf("]");n=n.substr(u+1,n.length);if(n.length<3){s.show(),r.hide(),i.hide();return}var a={searchtext:n};for(var f=0;f<t.ajaxparamnames.length;f++){var l=t.ajaxparamnames[f],c=e.one("#"+l);c&&(a[l]=c.get("value"))}e.io(t.url,{data:a,on:{success:function(n,u){var a;try{a=e.JSON.parse(u.responseText)}catch(f){return}a.error!==0?alert(a.error):(a.results.length>t.lookupcount?(r.show(),i.hide(),s.hide()):a.results.length===0?(s.hide(),i.show()):(r.hide(),i.hide(),s.hide()),o(a.results))}}})},resultFormatter:function(t,n){return e.Array.map(n,function(e){return e.raw})}}),u.ac.on("select",function(n){n.preventDefault();var r=n.itemNode.one("span"),i=r.get("id"),s=r.getContent(),f=s;f+="&nbsp;<span class='flookupset-delete'>",f+="<img src='"+M.util.image_url("t/delete")+"' alt = '"+M.str.moodle.delete+"' title='"+M.str.moodle.delete+"'/>",f+="</span>",f+="<input type='hidden' name='"+t.nameselected+"["+i+"]' />";var l=e.Node.create("<li>"+f+"</li>");a.append(l),l.one("input").set("value",s),o.set("value","filled"),o.simulate("change"),u.ac.hide(),u.set("value","")}),a.delegate("click",function(e){e.currentTarget.ancestor().remove(!0),a.hasChildNodes()||o.set("value",""),o.simulate("change")},"span"),n=u.next(".yui3-aclist"),n.appendTo("body"),r=e.Node.create('<div class="moreresults">'+M.util.get_string("lookupsetmoreresults","local_mbs")+"</div>"),r.hide(),n.one(".yui3-aclist-content").append(r),i=e.Node.create('<div class="noresults">'+M.util.get_string("lookupsetnoresults","local_mbs")+"</div>"),i.hide(),u.ancestor().append(i),s=e.Node.create('<div class="toolessletters">'+M.util.get_string("lookupsetlessletters","local_mbs")+"</div>"),s.hide(),u.ancestor().append(s)}}},"@VERSION@",{requires:["base","node","io-base","json","autocomplete","autocomplete-highlighters","autocomplete-filters","node-event-simulate"]});
