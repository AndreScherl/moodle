YUI.add("moodle-local_mbs-lookupset",function(e,t){M.local_mbs=M.local_mbs||{},M.local_mbs.lookupset={init:function(t){var n,r,i=e.one("#id_"+t.name),s=e.one("#id_"+t.name+"_search"),o=e.one("#id_"+t.name+"_list");s.plug(e.Plugin.AutoComplete,{resultFilters:null,resultHighligher:"phraseMatch",maxResults:t.lookupcount,source:function(n,i){var s=n.lastIndexOf("]");n=n.substr(s+1,n.length);if(n.length<3)return;var o={searchtext:n};for(var u=0;u<t.ajaxparamnames.length;u++){var a=t.ajaxparamnames[u],f=e.one("#"+a);f&&(o[a]=f.get("value"))}e.io(t.url,{data:o,on:{success:function(n,s){var o;try{o=e.JSON.parse(s.responseText)}catch(u){return}o.error!==0?alert(o.error):(o.results.length>t.lookupcount?r.show():r.hide(),i(o.results))}}})},resultFormatter:function(t,n){return e.Array.map(n,function(e){return e.raw})}}),s.ac.on("select",function(n){n.preventDefault();var r=n.itemNode.one("span"),u=r.get("id"),a=r.getContent(),f=a;f+="&nbsp;<span class='flookupset-delete'>",f+="<img src='"+M.util.image_url("t/delete")+"' alt = '"+M.str.moodle.delete+"' title='"+M.str.moodle.delete+"'/>",f+="</span>",f+="<input type='hidden' name='"+t.nameselected+"["+u+"]' value='"+a+"'/>",o.append(e.Node.create("<li>"+f+"</li>")),i.set("value","filled"),i.simulate("change"),s.ac.hide(),s.set("value","")}),o.delegate("click",function(e){e.currentTarget.ancestor().remove(!0),o.hasChildNodes()||i.set("value",""),i.simulate("change")},"span"),n=s.next(".yui3-aclist"),n.appendTo("body"),r=e.Node.create('<div class="moreresults">'+M.util.get_string("lookupsetmoreresults","local_mbs")+"</div>"),r.hide(),n.one(".yui3-aclist-content").append(r)}}},"@VERSION@",{requires:["base","node","io-base","json","autocomplete","autocomplete-highlighters","autocomplete-filters","node-event-simulate"]});
