YUI.add("moodle-block_mbstpl-templatesearch",function(e,t){M.block_mbstpl=M.block_mbstpl||{},M.block_mbstpl.templatesearch={init:function(){inputAction=function(t){var n=t.currentTarget.getDOMNode().value;n.length>=3?M.block_mbstpl.templatesearch.requestSuggestions(n,t.currentTarget):e.all(".mbstpl-suggestion").remove()},e.all("input[type=text]").each(function(t){t.on("keyup",inputAction),t.on("focus",inputAction),t.on("blur",function(){setTimeout(function(){e.all(".mbstpl-suggestion").remove()},100)})}),e.all(".mbstpl-list-controller img").on("click",function(t){t.preventDefault();var n=e.one('.mbstpl-search-form input[name="layout"]'),r=t.target.getAttribute("l");n.set("value",r);var i=e.all(".mbstpl-list-item");i.set("className"),i.addClass("mbstpl-list-item"),i.addClass("mbstpl-list-item-"+r)})},requestSuggestions:function(t,n){var r={method:"POST",sync:!1,timeout:5e3,data:{sesskey:M.cfg.sesskey,keyword:t,field:n.getDOMNode().name},on:{success:function(e,t){M.block_mbstpl.templatesearch.renderAutocomplete(e,t,n)}}};e.io(M.cfg.wwwroot+"/blocks/mbstpl/autocomplete.php",r)},selectSuggestion:function(t,n){var r=t.currentTarget.getHTML();n.set("value",r),e.all(".mbstpl-suggestion").remove()},renderAutocomplete:function(t,n,r){e.all(".mbstpl-suggestion").remove();var i=JSON.parse(n.response),s=r.getDOMNode().offsetWidth,o=r.getX();y=r.getY()+r.getDOMNode().offsetHeight,sendOnclick=function(e){M.block_mbstpl.templatesearch.selectSuggestion(e,r)};for(var u=0;u<i.length;u++){var a='<div class="mbstpl-suggestion" style=" top:'+y+"px; left:"+o+"px;width:"+s+'px">'+i[u]+"</div>",f=e.Node.create(a);f.on("click",sendOnclick),e.one("body").append(f),y+=f.getDOMNode().offsetHeight}}}},"@VERSION@",{requires:["base","node"]});
