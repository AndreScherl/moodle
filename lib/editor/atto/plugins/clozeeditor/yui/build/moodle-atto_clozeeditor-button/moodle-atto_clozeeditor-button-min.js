YUI.add("moodle-atto_clozeeditor-button",function(e,t){var o="atto_clozeeditor",i={WIDTH:"800px"},n='<form class="{{CSS.FORM}}"><fieldset><div class="{{CSS.FORMSETTINGS}}"><label for="{{elementid}}_atto_clozeeditor_type">{{get_string "type" component}}</label><select class="{{CSS.TYPE}}" id="atto_clozeeditor_type" /><option value="1" selected="selected">{{get_string "shortanswer" component}}</option><option value="2">{{get_string "shortanswer_c" component}}</option><option value="3">{{get_string "multichoice" component}}</option><option value="4">{{get_string "multichoice_v" component}}</option><option value="5">{{get_string "multichoice_h" component}}</option><option value="6">{{get_string "numerical" component}}</option></select></div><div class="{{CSS.FORMSETTINGS}}"><label for="{{elementid}}_atto_clozeeditor_points">{{get_string "points" component}}</label><select class="{{CSS.POINTS}}" id="atto_clozeeditor_points" /><option value="1" selected="selected">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></div></fieldset><br/><div><div class="{{CSS.ANSWER}}"><label for="answer_0">{{get_string "answer" component}}</label></div><div class="{{CSS.PERCENTAGE}}"><label for="{{elementid}}_atto_clozeeditor_percentage">{{get_string "percentage" component}}</label></div><div class="{{CSS.FEEDBACK}}"><label for="{{elementid}}_atto_clozeeditor_feedback">{{get_string "feedback" component}}</label></div></div><div class="{{CSS.OBJANSWER}}" id="atto_clozeeditor_answers" ><fieldset id="atto_clozeeditor_fieldset_answer"><div class="{{CSS.ANSWER}}"><input class="{{CSS.ANSWER}}" id="answer_0" /></div><div class="{{CSS.PERCENTAGE}}"><select class="{{CSS.PERCENTAGE}}" id="{{elementid}}_atto_clozeeditor_percentage" /><option value="100" selected="selected">100%</option><option value="75">75%</option><option value="67">66,6%</option><option value="50">50%</option><option value="34">33,3%</option><option value="25">25%</option><option value="0">0%</option></select></div><div class="{{CSS.FEEDBACK}}"><input class="{{CSS.FEEDBACK}}" id="{{elementid}}_atto_clozeeditor_feedback" /></div></fieldset></div><br/><div id="addanswers"> </div><div class="mdl-align"><br/><button class="submit" type="submit">{{get_string "createcloze" component}}</button></div></form>',l={TYPE:"type",POINTS:"points",OBJANSWER:"objanswer",ANSWER:"answer",PERCENTAGE:"percentage",FEEDBACK:"feedback",ADD:"add",SUBMIT:"submit",FORM:"atto_form",WIDTH:"customwidth",WIDTHUNIT:"%",FORMSETTINGS:"formsettings"},s={TYPE:"."+l.TYPE,POINTS:"."+l.POINTS,OBJANSWER:"."+l.OBJANSWER,ANSWER:"."+l.ANSWER,PERCENTAGE:"."+l.PERCENTAGE,FEEDBACK:"."+l.FEEDBACK,ADD:".add",SUBMIT:".submit",FORM:"."+l.FORM,WIDTH:"."+l.WIDTH};e.namespace("M.atto_clozeeditor").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_contextMenu:null,_lastTarget:null,_menuOptions:null,initializer:function(){this.addButton({icon:"e/question",callback:this._displayDialogue}),this.get("host").on("atto:selectionchanged",function(){this._existingCloze()?this.highlightButtons():this.unHighlightButtons()},this)},_storeCloze:function(t){var o,i,n=new Array(3),l=new Array(3);if(this._getClozeSpan()){t.clozeSpan=this.get("host").getSelectionParentNode().parentNode;var s=t.clozeSpan.innerHTML,a=s.indexOf("{"),r=s.indexOf("}");s=s.slice(a+1,r)}else if(this._getTinyCloze()){var s=this.get("host").getSelection().toString();s=s.slice(1,s.length-1)}l=s.split(":"),"SHORTANSWER"===l[1]?l[1]=1:"SHORTANSWER_C"===l[1]?l[1]=2:"MULTICHOICE"===l[1]?l[1]=3:"MULTICHOICE_V"===l[1]?l[1]=4:"MULTICHOICE_H"===l[1]?l[1]=5:"NUMERICAL"===l[1]?l[1]=6:l[1]=1,e.one("#atto_clozeeditor_type").set("value",l[1]),e.one("#atto_clozeeditor_points").set("value",l[0]),l[2]=l[2].split("~");for(var c=0;c<l[2].length;c++){l[2][c]=l[2][c].slice(1,l[2][c].length),o=l[2][c].indexOf("%"),i=l[2][c].indexOf("#"),n[0]=l[2][c].substring(o+1,i),n[1]=l[2][c].substring(0,o),n[2]=l[2][c].substring(i+1,l[2][c].length),l[2][c]=[];for(var d=0;d<n.length;d++)l[2][c][d]=n[d]}for(var g=0;g<l[2].length;g++){for(var _=0;3>_;_++)e.one("#atto_clozeeditor_answers").get("children").item(g).get("children").item(_).get("children").item(0).set("value",l[2][g][_]);this._addAnswer()}return l},_getClozeSpan:function(e){var t=this.get("host").getSelectionParentNode().parentNode;return"span"===t.nodeName.toLowerCase()&&"cloze"===t.getAttribute("name")?!0:!1},_getTinyCloze:function(e){var t=this.get("host").getSelection().toString();return t.length>1&&"{"===t[0]&&"}"===t[t.length-1]?!0:!1},_existingCloze:function(e){var t=this.get("host").getSelectionParentNode(),o=this.get("host").getSelection();return this.get("host").isActive()&&t&&o&&0!==o.length&&(this._getClozeSpan()||this._getTinyCloze())?!0:!1},_displayDialogue:function(e){if(this._currentSelection=this.get("host").getSelection(),this._currentSelection!==!1){var t=this.getDialogue({headerContent:M.util.get_string("createcloze",o),focusAfterHide:!0,width:i.WIDTH},!0);t.set("bodyContent",this._getDialogueContent(e)).show(),(this._getClozeSpan()||this._getTinyCloze())&&this._storeCloze(e)}},_getDialogueContent:function(t){var i=e.Handlebars.compile(n);return this._content=e.Node.create(i({CSS:l,elementid:this.get("host").get("elementid"),component:o})),this._content.one("#answer_0").on("valuechange",this._addAnswer,this),this._content.one(".submit").on("click",this._submitCloze,this),this._content},_submitCloze:function(e){var t,o,i,n=!1;switch(e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.get("host").setSelection(this._currentSelection),t=e.currentTarget.ancestor(s.FORM).one(s.TYPE),o=e.currentTarget.ancestor(s.FORM).one(s.POINTS),i="{"+o.get("value"),parseInt(t.get("value"))){case 1:i+=":SHORTANSWER:";break;case 2:i+=":SHORTANSWER_C:";break;case 3:i+=":MULTICHOICE:";break;case 4:i+=":MULTICHOICE_V:";break;case 5:i+=":MULTICHOICE_H:";break;case 6:i+=":NUMERICAL:";break;default:i+=":SHORTANSWER:"}for(var l=0;l<this._content.one("#atto_clozeeditor_answers").get("children").size();l++)tmpNode=this._content.one("#atto_clozeeditor_answers").get("children").item(l),tmpNode.get("children").item(0).get("children").item(0).get("value")&&(n&&(i+="~",n=!1),i+="%"+tmpNode.get("children").item(1).get("children").item(0).get("value")+"%"+tmpNode.get("children").item(0).get("children").item(0).get("value")+"#"+tmpNode.get("children").item(2).get("children").item(0).get("value"),n=!0);i+="}",this._getClozeSpan()?this.get("host").getSelectionParentNode().parentNode.innerHTML=i:(i='<span name="cloze">'+i+"</span>",this.get("host").insertContentAtFocusPoint(i)),this.markUpdated()},_addAnswer:function(){this._content.one("#atto_clozeeditor_answers").purge(!0,"valuechange"),tmpNode=e.one("#atto_clozeeditor_fieldset_answer").cloneNode(!0),tmpNode.get("children").item(0).get("children").item(0).set("value",""),tmpNode.get("children").item(2).get("children").item(0).set("value",""),tmpNode.get("children").item(0).get("children").item(0).on("valuechange",this._addAnswer,this),e.one("#atto_clozeeditor_answers").appendChild(tmpNode)}},{})},"@VERSION@",{requires:["moodle-editor_atto-plugin","moodle-editor_atto-menu","event","event-valuechange"]});