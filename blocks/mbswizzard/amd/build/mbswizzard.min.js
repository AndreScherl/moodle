require.config({paths:{"jquery.scrollTo":M.cfg.wwwroot+"/blocks/mbswizzard/js/scrollTo/jquery.scrollTo.min-2.1.0"},shim:{"jquery.scrollTo":{deps:["jquery"],exports:"jQuery.scrollTo"}}}),define(["jquery","theme_bootstrap/bootstrap","jquery.scrollTo"],function(a){"use strict";var b={sequence:{name:null,current_step:0,steps:[]},init:function(){a(".link_wizzard").on("click",a.proxy(function(b){this.event=b;var c="mbswizzard_sequence_"+a(b.target).attr("data-wizzard");this.copy_sequence_from_json(c,a.proxy(function(a){a&&(this.sequence=this.get_sequence(c),this.sequence.current_step=parseInt(this.sequence.current_step),this.set_wizzard_state("start",c)),localStorage.setItem("mbswizzard_current_sequence",c),window.location.replace(M.cfg.wwwroot+"/my")},this))},this)),!this.sequence.name&&localStorage.getItem("mbswizzard_current_sequence")&&(this.sequence=this.get_sequence(localStorage.getItem("mbswizzard_current_sequence")),this.sequence.current_step=parseInt(this.sequence.current_step)),this.sequence.name&&(this.show_tip(this.sequence.current_step),a("div[data-block=block_mbswizzard] .cancel").on("click",a.proxy(function(){this.finish_sequence("cancel")},this)))},copy_sequence_from_json:function(b,c){a.get(M.cfg.wwwroot+"/blocks/mbswizzard/js/sequences/"+b+".json",a.proxy(function(a){localStorage.setItem(b,JSON.stringify(a)),c(!0)},this),"json").fail(function(){alert("Sequence loading from json failed."),c(!1)})},get_sequence:function(a){var b=localStorage.getItem(a);return b?JSON.parse(b):null},store_sequence:function(a){localStorage.setItem(a.name,JSON.stringify(a))},show_tip:function(b){b>0&&a(this.sequence.steps[b-1].sel).tooltip("destroy");var c=this.sequence.steps[b];a(c.sel).is(":hidden")&&a(c.sel).css("visibility","visible");var d="top";c.placement&&(d=c.placement);var e={selector:"body",padding:0};c.viewport&&(e=c.viewport),a(c.sel).tooltip({html:!0,title:c.tip,trigger:"manual",placement:d,animation:!0,viewport:e}),a(c.sel).first().tooltip("show"),this.prepare_next_step(b);var f=a("#topbar").height()+a("header.me-page-header.full").height()+150;a.scrollTo(c.sel,1e3,{offset:{top:-f}}),this.update_progressbar()},prepare_next_step:function(b){return this.sequence.steps.length==b+1?void this.prepare_finish_sequence("finish"):void(this.sequence.steps[b].actionsel?a(this.sequence.steps[b].actionsel).on("click",a.proxy(function(){this.sequence.current_step=b+1,this.store_sequence(this.sequence),0===a(this.sequence.steps[b+1].sel).length||a(this.sequence.steps[b+1].sel).is(":hidden")?setTimeout(a.proxy(function(){this.show_tip(b+1)},this),500):this.show_tip(b+1),this.prepare_next_step(b+1)},this)):a(this.sequence.steps[b].sel).on("click",a.proxy(function(){this.sequence.current_step=b+1,this.store_sequence(this.sequence)},this)))},set_wizzard_state:function(b,c){a.ajax({url:M.cfg.wwwroot+"/blocks/mbswizzard/ajax.php",method:"POST",async:!1,data:{action:b+"wizzard",sequence:c,sesskey:M.cfg.sesskey}})},update_progressbar:function(){a("div[data-block=block_mbswizzard] .progress-bar").attr("aria-valuenow",this.sequence.current_step),a("div[data-block=block_mbswizzard] .progress-bar").attr("aria-valuemax",this.sequence.steps.length-1);var b=this.sequence.current_step/(this.sequence.steps.length-1)*100;a("div[data-block=block_mbswizzard] .progress-bar").attr("style","width: "+b+"%"),a("div[data-block=block_mbswizzard] .sr-only").text(b+"% Complete"),a("div[data-block=block_mbswizzard] .currentstepnumber").text(this.sequence.current_step+1),a("div[data-block=block_mbswizzard] .maxstepnumber").text(this.sequence.steps.length)},prepare_finish_sequence:function(b){a(this.sequence.steps[this.sequence.current_step].sel).on("click",a.proxy(function(){this.finish_sequence(b)},this))},finish_sequence:function(b){this.set_wizzard_state(b,this.sequence.name),localStorage.removeItem(this.sequence.name),localStorage.removeItem("mbswizzard_current_sequence"),a(".tooltip").tooltip("destroy"),"finish"===b&&(alert("Herzlichen Gl√ºckwunsch!\nSie haben den Wizzard erfolgreich abgeschlossen."),exit())}};return{initialize:function(){b.init()}}});