YUI.add("moodle-block_mbssearch-searchpage",function(e,t){M.block_mbssearch=M.block_mbssearch||{},M.block_mbssearch.initsearchpage=function(t){function o(){var o={};o.action="loadmoreresults",o.searchtext=e.one("#mbssearchpage_form #searchtext").get("value"),o.limitfrom=n,o.limitnum=r,o.schoolcatid=i,o.filterby=e.one("#mbssearchpage_form #menufilterby").get("value");var a=M.util.add_spinner(e,s);e.io(t.url,{data:o,on:{start:function(){a.show()},success:function(t,n){var r;try{r=e.JSON.parse(n.responseText)}catch(i){return}a.hide(),r.error!==0?alert(r.error):u(r.results)},failure:function(){a.hide()}}})}function u(t){t.limitfrom+t.limitnum>=t.total&&e.one("#loadmoreresults").hide(),e.one("#mbssearch_resultlist").append(t.html),n+=r}function a(){n=Number(t.limitfrom),r=Number(t.limitnum),i=Number(t.schoolcatid),s=e.one("#loadmoreresults"),e.one("#mbssearchpage_form #menufilterby").on("change",function(t){e.one("#mbssearchpage_form").submit()}),s&&s.set("href","#"),e.one("#mbssearch_result").delegate("click",function(e){e.preventDefault(),o()},"#loadmoreresults")}var n,r,i,s;a()}},"@VERSION@");
